{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col-md-8 offset-md-2">
    <h2 class="mt-4">Hello, {{ user.phone_number }}!</h2>
    <p>You have joined {{ user.groups_joined_count }} out of 3 allowed groups.</p>

    <!-- Active tokens section -->
    <h4>Your Active Group Invite Links</h4>
    {% if active_tokens %}
      <ul class="list-group mb-4">
        {% for t in active_tokens %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>{{ t.group.name }} (expires: {{ t.expires_at }})</span>
            <a href="{{ url_for('dashboard_bp.use_token', token=t.token) }}" class="btn btn-sm btn-success" target="_blank">Join Now</a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted">No active tokens. Generate a link below.</p>
    {% endif %}

    <!-- Search form -->
    <form class="d-flex mb-3" method="GET" action="{{ url_for('dashboard_bp.dashboard') }}">
      <input class="form-control me-2" type="search" placeholder="Search groups..." name="search" value="{{ search_query }}">
      <button class="btn btn-outline-primary" type="submit">Search</button>
    </form>

    <!-- Groups list -->
    <h4>Available Groups</h4>
    <ul class="list-group">
      {% for g in groups %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <span>{{ g.name }}</span>
          {% if user.groups_joined_count < 3 %}
            <form action="{{ url_for('dashboard_bp.request_group', group_id=g.id) }}" method="POST">
              <button class="btn btn-primary btn-sm" type="submit">Get Invite Link</button>
            </form>
          {% else %}
            <button class="btn btn-secondary btn-sm" disabled>Max Groups Joined</button>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}
